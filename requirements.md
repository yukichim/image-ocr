# 税務・経理書類特化型 OCRエンジン仕様書

## 1. 概要
本システムは、領収書、請求書、決算書、公的控除証明書などの紙書類スキャン画像を入力とし、税務処理に必要な重要項目（日付、金額、取引先、税率区分など）を構造化データ（JSON）として出力する。

## 2. 対応ドキュメントと抽出項目

### A. 領収書・レシート (Receipts)
* **特徴:** 感熱紙、長尺、レイアウト自由、ノイズ多。
* **必須抽出項目:**
    * 日付 (Date): 和暦・西暦の混在に対応。
    * 合計金額 (Total Amount): 3桁区切り、通貨記号の除去。
    * 取引先名 (Store Name): 電話番号検索などの補正も視野。
    * 明細 (Items): 品名と単価。
* **特記事項 (軽減税率判定):**
    * 明細行にある「※」「軽」「8%」などの記号をOCRで検出し、対象品目が軽減税率（8%）である可能性をフラグ付けする。

### B. 請求書 (Invoices)
* **特徴:** A4サイズ、表形式が一般的。手書きと活字の混在。
* **必須抽出項目:**
    * 請求日 / 支払期限
    * 請求総額 (消費税内訳含む)
    * 取引先名 (発行元)
    * 振込先口座情報 (銀行名、支店名、口座番号)

### C. 医療費領収書 (Medical Receipts)
* **特徴:** 病院ごとの独自フォーマットだが、点数表などは類似。
* **必須抽出項目:**
    * 医療機関名 / 薬局名
    * 診療年月日
    * 領収金額 (保険適用分 + 自費分の合計)
    * *区分:* 診療・治療・医薬品など（セルフメディケーション税制判定用）

### D. 寄附金受領証明書 (Donation Certificates)
* **特徴:** ふるさと納税などで利用。形式は比較的定型。
* **必須抽出項目:**
    * 寄附年月日
    * 寄附金額
    * 寄附先名称 (自治体名・団体名)

### E. 決算書・財務諸表 (Financial Statements)
* **特徴:** 罫線を含む**表組み (Table)** 構造。貸借対照表(BS)・損益計算書(PL)。
* **必須抽出項目:**
    * 勘定科目名 (Assets/Liabilities keys)
    * 該当金額 (Values)
    * ※ 行と列の関係性を維持して抽出する必要あり。

### F. 源泉徴収票 (Withholding Slips)
* **特徴:** 役所指定の厳格なフォーマット。
* **必須抽出項目:**
    * 支払金額
    * 源泉徴収税額
    * 控除対象配偶者の有無
    * 支払者住所・氏名

## 3. 処理パイプライン

1.  **画像前処理:** 傾き補正、影の除去、二値化。
2.  **文書分類 (Classification):** 画像全体の特徴から「これはレシートか？請求書か？」を判定。
3.  **領域検出 (Detection):** テキストブロックおよび表（Table）の領域を特定。
4.  **文字認識 (Recognition):** 日本語OCR実行。
5.  **意味抽出 (Semantic Extraction):**
    * OCR結果の座標とキーワード（「合計」「Total」など）に基づき、値を特定する（Key-Value Extraction）。
6.  **データ正規化:**
    * 日付: `R5.12.1` -> `2023-12-01`
    * 金額: `¥1,000-` -> `1000` (Int)

## 4. エラーハンドリング
* 読み取り信頼度 (Confidence Score) が閾値未満の場合は「要確認」フラグを付与する。